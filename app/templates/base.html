<!doctype html>
<html lang="{{ get_locale() }}" class="has-navbar-fixed-top">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    {% if title %}
    <title>MyFoil | {{ t(title) }}</title>
    {%else%}
    <title>MyFoil</title>
    {%endif%}

    <!-- Bulma CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@1.0.0/css/bulma.min.css">

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>

    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

    <style>
        /* Dark Mode Support for Bulma */
        :root[data-theme="dark"] {
            --bulma-background-scheme: #0f172a;
            --bulma-background: #0f172a;
            --bulma-text-strong: #f8fafc;
            --bulma-text: #cbd5e1;
            --bulma-card-background: #1e293b;
            --bulma-card-header-color: #f8fafc;
            --bulma-input-background: #1e293b;
            --bulma-input-color: #f1f5f9;
            --bulma-input-border: #334155;
            --bulma-input-placeholder-color: rgba(255, 255, 255, 0.4);
            --bulma-border: #334155;
            --bulma-navbar-background-color: #1e293b;
            --bulma-navbar-item-color: #f1f5f9;
            --bulma-navbar-item-hover-background-color: #334155;
            --bulma-modal-card-head-background-color: #1e293b;
            --bulma-modal-card-body-background-color: #0f172a;
            --bulma-modal-card-foot-background-color: #1e293b;
            --bulma-link: #a78bfa;
            --bulma-primary: #7c3aed;
        }

        [data-theme="dark"] body {
            background-color: var(--bulma-background);
            color: var(--bulma-text);
        }

        [data-theme="dark"] .card,
        [data-theme="dark"] .box,
        [data-theme="dark"] .navbar,
        [data-theme="dark"] .modal-card-body,
        [data-theme="dark"] .modal-card-head,
        [data-theme="dark"] .modal-card-foot {
            background-color: var(--bulma-card-background) !important;
            color: var(--bulma-text) !important;
        }

        [data-theme="dark"] .title,
        [data-theme="dark"] strong {
            color: #ffffff !important;
        }

        [data-theme="dark"] .subtitle,
        [data-theme="dark"] .help,
        [data-theme="dark"] .label {
            color: #cbd5e1 !important;
        }

        [data-theme="dark"] .tag:not(.is-primary):not(.is-success):not(.is-warning):not(.is-danger) {
            background-color: #334155 !important;
            color: #f1f5f9 !important;
        }

        [data-theme="dark"] .button.is-light {
            background-color: #334155 !important;
            color: #f1f5f9 !important;
            border-color: #475569 !important;
        }

        [data-theme="dark"] .button.is-primary.is-light {
            background-color: rgba(124, 58, 237, 0.2) !important;
            color: #a78bfa !important;
        }

        [data-theme="dark"] .input,
        [data-theme="dark"] .select select,
        [data-theme="dark"] .textarea {
            background-color: var(--bulma-input-background) !important;
            color: var(--bulma-input-color) !important;
            border-color: var(--bulma-input-border) !important;
        }

        [data-theme="dark"] .navbar-item,
        [data-theme="dark"] .navbar-link {
            color: var(--bulma-navbar-item-color) !important;
        }

        [data-theme="dark"] .navbar-item:hover,
        [data-theme="dark"] .navbar-link:hover {
            background-color: var(--bulma-navbar-item-hover-background-color) !important;
        }

        [data-theme="dark"] .table {
            background-color: transparent !important;
            color: var(--bulma-text) !important;
        }

        [data-theme="dark"] .table thead th {
            color: var(--bulma-text-strong) !important;
            border-bottom-color: var(--bulma-border);
        }

        [data-theme="dark"] .table td,
        [data-theme="dark"] .table th {
            border-color: var(--bulma-border) !important;
        }

        /* Custom primary color to match old design */
        .is-primary {
            background-color: #7c3aed !important;
            color: #ffffff !important;
        }

        .has-text-primary {
            color: #7c3aed !important;
        }

        #toastContainer {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 1000;
        }

        .notification.is-toast {
            margin-bottom: 0.75rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Sticky Footer */
        body {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        main {
            flex: 1;
        }
    </style>
</head>

<body>
    <main>
        {% block content %}
        {% endblock %}
    </main>

    <!-- Footer with System Information -->
    <footer class="footer has-background-dark has-text-light py-2 mt-auto">
        <div class="container is-fluid">
            <div class="columns is-vcentered is-mobile is-multiline">
                <div class="column is-12-mobile is-4-tablet">
                    <p class="is-size-7 opacity-70">
                        <span class="has-text-weight-bold">Build:</span> {{ build_version }}
                    </p>
                </div>
                <div class="column is-12-mobile is-4-tablet has-text-centered-tablet">
                    <p class="is-size-7 opacity-70">
                        <span class="has-text-weight-bold">Identificação:</span> <span
                            id="idSource">Carregando...</span>
                    </p>
                </div>
                <div class="column is-12-mobile is-4-tablet has-text-right-tablet">
                    <p class="is-size-7 opacity-70">
                        <span class="has-text-weight-bold">Updates:</span> <span id="updateSource">Carregando...</span>
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <div id="toastContainer"></div>

    <script>
        function showToast(message, type = 'success') {
            const container = document.getElementById('toastContainer');
            const notification = document.createElement('div');
            const colorClass = type === 'success' ? 'is-success' : 'is-danger';

            notification.className = `notification ${colorClass} is-toast`;
            notification.innerHTML = `
                <button class="delete" onclick="this.parentElement.remove()"></button>
                <div class="is-flex is-align-items-center gap-2">
                    <i class="bi bi-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
                    <strong>${message}</strong>
                </div>
            `;

            container.appendChild(notification);
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transition = 'opacity 0.5s';
                setTimeout(() => notification.remove(), 500);
            }, 3000);
        }

        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        }

        document.addEventListener('DOMContentLoaded', function () {
            const savedTheme = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
            document.documentElement.setAttribute('data-theme', savedTheme);

            // Load system information for footer (Global)
            $.getJSON('/api/system/info', function (data) {
                $('#idSource').text(data.id_source);
                $('#updateSource').text(data.update_source);
            }).fail(function () {
                $('#idSource').text('N/A');
                $('#updateSource').text('N/A');
            });

            // WebSocket Global Listener
            if (typeof io !== 'undefined') {
                const socket = io();
                socket.on('connect', () => console.log('WebSocket: Connected'));
                socket.on('library_updated', (data) => {
                    console.log('WebSocket: Library update received', data);
                    if (typeof refreshLibrary === 'function') {
                        refreshLibrary();
                    }
                });
            }
        });
    </script>
</body>

</html>