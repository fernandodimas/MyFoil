{% extends "base.html" %}

{% block content %}
{% include 'nav.html' %}

<div class="container is-fluid px-5 mt-5 pb-6">

    <!-- Controls Row -->
    <div class="box p-3 mb-4 shadow-sm border-none bg-glass" style="position: relative; z-index: 20;">
        <div class="is-flex is-flex-wrap-wrap is-align-items-center gap-3 px-1">

            <!-- Left Group: Primary Filters -->
            <div class="is-flex gap-2 is-justify-content-center-mobile is-flex-grow-1-mobile">
                <!-- Filters Dropdown -->
                <div class="dropdown" id="filterDropdown">
                    <div class="dropdown-trigger">
                        <button class="button is-primary is-small" aria-haspopup="true">
                            <span class="icon is-small"><i class="bi bi-funnel-fill"></i></span>
                            <span class="is-hidden-mobile ml-1">{{ t('dashboard.filters') }}</span>
                            <span class="icon is-small ml-1 is-hidden-tablet"><i class="bi bi-caret-down-fill"
                                    style="font-size: 0.5rem"></i></span>
                        </button>
                    </div>
                    <div class="dropdown-menu" id="dropdown-menu" role="menu" style="z-index: 200;">
                        <div class="dropdown-content p-4" style="min-width: 260px;">
                            <div class="field mb-3">
                                <label class="label is-size-7 opacity-70">{{ t('dashboard.genre') }}</label>
                                <div class="control">
                                    <div class="select is-small is-fullwidth">
                                        <select id="filterGender" class="filterInput">
                                            <option value="">{{ t('dashboard.all_genres') }}</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="field">
                                <label class="label is-size-7 opacity-70">{{ t('dashboard.tag') }}</label>
                                <div class="control">
                                    <div class="select is-small is-fullwidth">
                                        <select id="filterTag" class="filterInput">
                                            <option value="">{{ t('dashboard.all_tags') }}</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sorting Dropdown -->
                <div class="dropdown" id="sortDropdown">
                    <div class="dropdown-trigger">
                        <button class="button is-info is-small is-light" aria-haspopup="true">
                            <span class="icon is-small"><i class="bi bi-sort-down"></i></span>
                            <span class="is-hidden-mobile ml-1">{{ t('dashboard.sort') }}</span>
                        </button>
                    </div>
                    <div class="dropdown-menu" id="sort-menu" role="menu" style="z-index: 200;">
                        <div class="dropdown-content p-2" style="min-width: 200px;">
                            <a class="dropdown-item is-size-7 sort-option" data-sort="name-asc">{{
                                t('dashboard.sort_az') }}</a>
                            <a class="dropdown-item is-size-7 sort-option" data-sort="name-desc">{{
                                t('dashboard.sort_za') }}</a>
                            <hr class="dropdown-divider">
                            <a class="dropdown-item is-size-7 sort-option" data-sort="release-desc">{{
                                t('dashboard.sort_release_new') }}</a>
                            <a class="dropdown-item is-size-7 sort-option" data-sort="release-asc">{{
                                t('dashboard.sort_release_old') }}</a>
                            <hr class="dropdown-divider">
                            <a class="dropdown-item is-size-7 sort-option" data-sort="added-desc">{{
                                t('dashboard.sort_added_new') }}</a>
                            <a class="dropdown-item is-size-7 sort-option" data-sort="added-asc">{{
                                t('dashboard.sort_added_old') }}</a>
                            <hr class="dropdown-divider">
                            <a class="dropdown-item is-size-7 sort-option" data-sort="id-asc">{{ t('dashboard.sort_tid')
                                }}</a>
                            <a class="dropdown-item is-size-7 sort-option" data-sort="status-desc">{{
                                t('dashboard.sort_status') }}</a>
                            <hr class="dropdown-divider">
                            <a class="dropdown-item is-size-7 sort-option" data-sort="size-desc">{{
                                t('dashboard.sort_size_desc') }}</a>
                            <a class="dropdown-item is-size-7 sort-option" data-sort="size-asc">{{
                                t('dashboard.sort_size_asc') }}</a>
                        </div>
                    </div>
                </div>

                <!-- Quick Status Filters -->
                <div class="buttons has-addons m-0">
                    <button class="button is-small is-light" id="btnFilterPendingBase"
                        title="{{ t('dashboard.filter_missing_base') }}">
                        <span class="icon is-small"><i class="bi bi-disc"></i></span>
                        <span class="is-hidden-mobile ml-1">Base</span>
                    </button>
                    <button class="button is-small is-light" id="btnFilterPendingUpd"
                        title="{{ t('dashboard.filter_pending_update') }}">
                        <span class="icon is-small"><i class="bi bi-arrow-up-circle"></i></span>
                        <span class="is-hidden-mobile ml-1">Update</span>
                    </button>
                    <button class="button is-small is-light" id="btnFilterPendingDlc"
                        title="{{ t('dashboard.filter_pending_dlc') }}">
                        <span class="icon is-small"><i class="bi bi-plus-circle"></i></span>
                        <span class="is-hidden-mobile ml-1">DLC</span>
                    </button>
                    <button class="button is-small is-light" id="btnFilterRedundant"
                        title="{{ t('dashboard.filter_redundant') }}">
                        <span class="icon is-small"><i class="bi bi-layers-half"></i></span>
                        <span class="is-hidden-mobile ml-1">Redundante</span>
                    </button>
                </div>

                <button id="clearFiltersBtn" class="button is-small is-outlined is-danger" onclick="clearFilters()"
                    title="{{ t('dashboard.clear_filters') }}">
                    <span class="icon is-small"><i class="bi bi-x"></i></span>
                </button>
            </div>

            <!-- Right Group: Secondary Controls (Pushed to the right on desktop) -->
            <div class="is-flex gap-2 is-align-items-center is-justify-content-center-mobile is-flex-grow-1-mobile"
                style="margin-left: auto;">
                <div class="is-hidden-mobile mr-2">
                    <span class="is-size-7 opacity-50 font-mono" id="totalItemsCount">-- {{ t('dashboard.items_count')
                        }}</span>
                </div>

                <div class="is-flex is-align-items-center is-hidden-mobile" style="min-width: 100px;">
                    <i class="bi bi-zoom-in is-size-7 mr-2 opacity-50"></i>
                    <input id="gridZoom" class="slider is-small is-primary m-0" type="range" min="180" max="400"
                        step="10" value="240">
                </div>

                <div class="buttons has-addons m-0 view-toggle" id="viewToggleButtons">
                    <button class="button is-small" onclick="setView('card')" id="btnViewCard"
                        title="{{ t('dashboard.view_card') }}"><span class="icon is-small"><i
                                class="bi bi-grid-fill"></i></span></button>
                    <button class="button is-small" onclick="setView('icon')" id="btnViewIcon"
                        title="{{ t('dashboard.view_icon') }}"><span class="icon is-small"><i
                                class="bi bi-image"></i></span></button>
                    <button class="button is-small" onclick="setView('list')" id="btnViewList"
                        title="{{ t('dashboard.view_list') }}"><span class="icon is-small"><i
                                class="bi bi-list-ul"></i></span></button>
                </div>
            </div>

            <div class="is-hidden-tablet is-flex-grow-1 has-text-centered">
                <span class="is-size-7 opacity-50" id="totalItemsCountMobile">-- {{ t('dashboard.items_count') }}</span>
            </div>
        </div>
    </div>

    <!-- Library Content -->
    <div class="box bg-transparent shadow-none border-none p-0">
        <div id="libraryContainer" class="mt-2">
            <!-- Dynamic content injected via JS -->
        </div>
    </div>

    <!-- No Results -->
    <div id="noResults" class="is-hidden has-text-centered py-6">
        <div class="card p-5">
            <i class="bi bi-search is-size-1 opacity-20 block mb-4"></i>
            <h3 class="title is-4">{{ t('dashboard.no_games_found') }}</h3>
            <p class="subtitle is-6 opacity-50">{{ t('dashboard.try_adjusting_filters') }}</p>
        </div>
    </div>

    <!-- Infinite scroll loading indicator -->
    <div id="scrollLoading" class="has-text-centered py-4 is-hidden">
        <span class="loader is-loading is-inline-block" style="width: 24px; height: 24px; border-width: 3px;"></span>
        <p class="is-size-7 mt-2 opacity-60">{{ t('dashboard.loading_more') }}</p>
    </div>

    <!-- Loading indicator - Main -->
    <div id="loadingIndicator" class="has-text-centered py-6 is-hidden">
        <div class="loading-overlay">
            <div class="loading-spinner is-large"></div>
            <div class="progress-container mt-4 mx-auto" style="max-width: 200px;">
                <progress class="progress is-small is-primary" value="0" max="100" id="loadingProgress">0%</progress>
            </div>
            <p class="is-size-6 mt-4 opacity-60 has-text-weight-medium" id="loadingText">{{
                t('dashboard.loading_library') }}</p>
        </div>
    </div>

    <!-- Loading indicator - Pagination -->
    <div id="paginationLoader" class="has-text-centered py-4 is-hidden bg-glass rounded">
        <div class="is-flex is-align-items-center is-justify-content-center gap-2">
            <span class="icon is-small has-text-primary"><i class="fas fa-spinner fa-spin"></i></span>
            <span class="is-size-7 has-text-grey">{{ t('dashboard.loading_more') }}</span>
        </div>
    </div>
</div>

<script src="/static/js/index.js?v={{ build_version }}"></script>
{% endblock %}