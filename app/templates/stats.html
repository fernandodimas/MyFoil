{% extends "base.html" %}

{% block content %}
{% include 'nav.html' %}

<section class="section">
    <div class="container is-fluid px-5">
        <div class="columns is-multiline">
            <!-- Header Stats -->
            <div class="column is-12">
                <div class="level">
                    <div class="level-left">
                        <div>
                            <h1 class="title is-2 mb-2" style="font-weight: 800; letter-spacing: -1px;">üìä {{
                                t('Dashboard de Estat√≠sticas') }}</h1>
                            <p class="subtitle is-6 opacity-60">{{ t('Vis√£o geral da sua cole√ß√£o e compara√ß√£o com o
                                cat√°logo global.') }}</p>
                        </div>
                    </div>
                    <div class="level-right">
                        <div class="field">
                            <label class="label is-small opacity-50">{{ t('Filtrar por Biblioteca') }}</label>
                            <div class="control has-icons-left">
                                <span class="select is-rounded is-small">
                                    <select id="libraryFilter" onchange="loadStats()">
                                        <option value="">{{ t('Todas as Bibliotecas') }}</option>
                                    </select>
                                </span>
                                <span class="icon is-small is-left">
                                    <i class="bi bi-folder2-open"></i>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stats Cards Row -->
            <div class="column is-3">
                <div class="card box shadow-sm border-none p-5 h-100">
                    <p class="heading is-size-7 opacity-50 mb-2">{{ t('Total da Biblioteca') }}</p>
                    <div class="is-flex is-align-items-center mb-3">
                        <span class="icon is-large has-text-primary mr-3">
                            <i class="bi bi-collection-play is-size-3"></i>
                        </span>
                        <div>
                            <p class="title is-3 m-0" id="stat-total-games">--</p>
                            <p class="is-size-7" id="stat-total-files-top">-- {{ t('Arquivos') }}</p>
                        </div>
                    </div>
                    <div class="pt-3 border-top">
                        <p class="is-size-7 opacity-70"><i class="bi bi-hdd mr-1"></i> <span
                                id="stat-total-size">--</span> {{ t('em disco') }}</p>
                    </div>
                </div>
            </div>

            <div class="column is-3">
                <div class="card box shadow-sm border-none p-5 h-100">
                    <p class="heading is-size-7 opacity-50 mb-2">{{ t('Status da Cole√ß√£o') }}</p>
                    <div class="is-flex is-align-items-center mb-3">
                        <span class="icon is-large has-text-success mr-3">
                            <i class="bi bi-check-circle-fill is-size-3"></i>
                        </span>
                        <div>
                            <p class="title is-3 m-0" id="stat-up-to-date-pct">-- %</p>
                            <p class="is-size-7" id="stat-up-to-date-count">-- {{ t('atualizados') }}</p>
                        </div>
                    </div>
                    <div class="pt-3 border-top">
                        <p class="is-size-7 opacity-70"><i class="bi bi-clock-history mr-1"></i> <span
                                id="stat-pending-count">--</span> {{ t('pendentes') }}</p>
                    </div>
                </div>
            </div>

            <div class="column is-3">
                <div class="card box shadow-sm border-none p-5 h-100">
                    <p class="heading is-size-7 opacity-50 mb-2">{{ t('Cobertura TitleDB') }}</p>
                    <div class="is-flex is-align-items-center mb-3">
                        <span class="icon is-large has-text-warning mr-3">
                            <i class="bi bi-globe2 is-size-3"></i>
                        </span>
                        <div>
                            <p class="title is-3 m-0" id="stat-coverage-pct">-- %</p>
                            <p class="is-size-7">{{ t('Cat√°logo Global') }}</p>
                        </div>
                    </div>
                    <div class="pt-3 border-top">
                        <p class="is-size-7 opacity-70"><i class="bi bi-database mr-1"></i> <span
                                id="stat-total-available">--</span> {{ t('t√≠tulos') }}</p>
                    </div>
                </div>
            </div>

            <div class="column is-3">
                <div class="card box shadow-sm border-none p-5 h-100">
                    <p class="heading is-size-7 opacity-50 mb-2">{{ t('Sa√∫de da Identifica√ß√£o') }}</p>
                    <div class="is-flex is-align-items-center mb-3">
                        <span class="icon is-large has-text-info mr-3">
                            <i class="bi bi-fingerprint is-size-3"></i>
                        </span>
                        <div>
                            <p class="title is-4 m-0"><span id="stat-id-rate">--</span>% / <span
                                    id="stat-recognition-pct" class="has-text-primary">--</span>%</p>
                        </div>
                    </div>
                    <div class="pt-3 border-top">
                        <div class="is-flex is-justify-content-between is-align-items-center">
                            <p class="is-size-7 opacity-70" title="{{ t('Arquivos n√£o identificados') }}">
                                <i class="bi bi-file-earmark-x mr-1"></i> <span id="stat-unidentified-files"
                                    class="has-text-danger">--</span>
                            </p>
                            <p class="is-size-7 opacity-70" title="{{ t('T√≠tulos sem nome no Banco de Dados') }}">
                                <i class="bi bi-question-circle mr-1"></i> <span id="stat-unrecognized-count"
                                    class="has-text-warning">--</span>
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Breakdown Row -->
            <div class="column is-12">
                <div class="level box py-3 px-5 mb-0 shadow-none border bg-light-soft">
                    <div class="level-item has-text-centered">
                        <div>
                            <p class="heading opacity-50 m-0">{{ t('Jogos Base') }}</p>
                            <p class="title is-5" id="stat-total-bases">--</p>
                        </div>
                    </div>
                    <div class="level-item has-text-centered">
                        <div>
                            <p class="heading opacity-50 m-0">{{ t('Updates') }}</p>
                            <p class="title is-5" id="stat-total-updates">--</p>
                        </div>
                    </div>
                    <div class="level-item has-text-centered">
                        <div>
                            <p class="heading opacity-50 m-0">{{ t('DLCs') }}</p>
                            <p class="title is-5" id="stat-total-dlcs">--</p>
                        </div>
                    </div>
                    <div class="level-item has-text-centered">
                        <div>
                            <p class="heading opacity-50 m-0">{{ t('Fonte TitleDB') }}</p>
                            <p class="title is-5 is-size-6" id="stat-source-name">--</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Charts Row -->
            <div class="column is-12">
                <div class="card box shadow-sm">
                    <header class="card-header border-none shadow-none">
                        <p class="card-header-title">
                            <i class="bi bi-pie-chart-fill mr-2 has-text-primary"></i> {{ t('Distribui√ß√£o por G√™nero')
                            }}
                        </p>
                    </header>
                    <div class="card-content pt-0">
                        <div style="height: 300px; position: relative;">
                            <canvas id="genreChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Additions -->
            <div class="column is-12">
                <div class="card box shadow-sm">
                    <header class="card-header border-none shadow-none">
                        <p class="card-header-title">
                            <i class="bi bi-clock-history mr-2 has-text-primary"></i> {{ t('Adicionados Recentemente')
                            }}
                        </p>
                    </header>
                    <div class="card-content pt-0">
                        <div id="recentGamesList" class="columns is-multiline">
                            <!-- Injected by JS -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="/static/js/stats.js?v={{ build_version }}"></script>
{% endblock %}