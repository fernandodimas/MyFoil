{% extends "base.html" %}
{% block content %}
<script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
{% include 'nav.html' %}

<section class="section">
    <div class="container px-5">
        <div class="columns is-variable is-8">

            <!-- Sidebar Navigation -->
            <div class="column is-3">
                <aside class="menu is-sticky">
                    <p class="menu-label has-text-weight-black is-size-5 mb-5 tracking-tighter">
                        <i class="bi bi-sliders2-vertical has-text-primary mr-2"></i> Configurações
                    </p>
                    <ul class="menu-list" id="settingsNav">
                        <li><a data-target="General" class="is-active"><i class="bi bi-gear-fill mr-2"></i> Geral</a>
                        </li>
                        <li><a data-target="Authentication"><i class="bi bi-people-fill mr-2"></i> Autenticação</a></li>
                        <li><a data-target="Library"><i class="bi bi-folder2-open mr-2"></i> Biblioteca</a></li>
                        <li><a data-target="FileExplorer"><i class="bi bi-files mr-2"></i> Explorador de Arquivos</a>
                        </li>
                        <li><a data-target="Renaming"><i class="bi bi-pencil-square mr-2"></i> Renomeação</a></li>
                        <li><a data-target="TitleDB"><i class="bi bi-database-fill mr-2"></i> TitleDB</a>
                        </li>
                        <li><a data-target="Shop"><i class="bi bi-cart-fill mr-2"></i> Loja</a></li>
                        <li><a data-target="Errors"><i class="bi bi-exclamation-octagon-fill mr-2"></i>
                                Erros/Identificação</a></li>
                        <li><a data-target="Tags"><i class="bi bi-tags-fill mr-2"></i> Tags</a></li>
                        <li><a data-target="Activity"><i class="bi bi-clock-history mr-2"></i> Atividade</a></li>
                        <li><a data-target="Backups"><i class="bi bi-shield-check mr-2"></i> Backups</a></li>
                        <li><a data-target="Webhooks"><i class="bi bi-plug-fill mr-2"></i> Webhooks <span
                                    class="tag is-warning is-light is-size-9 ml-1"
                                    style="font-size: 0.6rem;">BETA</span></a></li>
                        <li><a data-target="Cloud"><i class="bi bi-cloud-fill mr-2"></i> Cloud Storage <span
                                    class="tag is-warning is-light is-size-9 ml-1"
                                    style="font-size: 0.6rem;">BETA</span></a></li>
                        <li><a data-target="Plugins"><i class="bi bi-patch-check mr-2"></i> Plugins <span
                                    class="tag is-warning is-light is-size-9 ml-1"
                                    style="font-size: 0.6rem;">BETA</span></a></li>
                        <li><a data-target="APIs"><i class="bi bi-cloud-arrow-down-fill mr-2"></i> APIs Externas</a>
                        </li>
                        <li><a data-target="Help"><i class="bi bi-question-circle mr-2"></i> Ajuda</a></li>
                    </ul>
                </aside>
            </div>

            <!-- Main Content Area -->
            <div class="column is-9">
                <!-- Loading Overlay -->
                <div id="settingsLoading" class="has-text-centered py-6">
                    <button class="button is-loading is-ghost is-large"></button>
                    <p class="mt-4 has-text-weight-bold">Carregando configurações...</p>
                </div>

                <div id="settingsContent" class="is-hidden animate-fade-in settings-container p-5">
                    <!-- Alerts -->
                    <div id="globalAlerts" class="mb-5">
                        {% if admin_account_created == false %}
                        <div class="notification is-ghost border p-4 mb-4"
                            style="border-left: 5px solid var(--color-danger) !important;">
                            <div class="is-flex is-align-items-center gap-3">
                                <i class="bi bi-exclamation-triangle-fill is-size-4 has-text-danger"></i>
                                <div>
                                    <strong class="is-block uppercase is-size-7 tracking-widest has-text-danger">Conta
                                        Admin
                                        Ausente!</strong>
                                    <span class="is-size-7">Autenticação desativada. Qualquer um pode acessar e alterar
                                        configurações.</span>
                                </div>
                            </div>
                        </div>
                        {% endif %}

                        {% if valid_keys == false %}
                        <div id="keysAlert" class="notification is-ghost border p-4 mb-4"
                            style="border-left: 5px solid var(--color-warning) !important;">
                            <div class="is-flex is-align-items-center gap-3">
                                <i class="bi bi-key-fill is-size-4 has-text-warning"></i>
                                <div>
                                    <strong class="is-block uppercase is-size-7 tracking-widest has-text-warning">Chaves
                                        do console
                                        ausentes!</strong>
                                    <span class="is-size-7">
                                        Necessário para decriptar conteúdo Nintendo.
                                        <a target="_blank"
                                            href="https://gitlab.com/easyhacking/switch/-/wikis/home/getting-started/dump-keys"
                                            class="has-text-weight-bold is-underlined ml-1">Guia</a>
                                    </span>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                    </div>

                    <!-- Tab Sections -->

                    <!-- General Section -->
                    <section id="section-General" class="settings-section">
                        <div class="card box shadow-sm">
                            <header class="card-header border-none shadow-none">
                                <p class="card-header-title has-text-primary">
                                    <i class="bi bi-gear-fill mr-2"></i> Configuração Geral
                                </p>
                            </header>
                            <div class="card-content pt-0">
                                <div class="columns is-multiline">
                                    <div class="column is-6">
                                        <div class="field">
                                            <label class="label is-small">Região da Biblioteca</label>
                                            <div class="control is-expanded">
                                                <div class="select is-fullwidth">
                                                    <select id="selectRegion"></select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="column is-6">
                                        <div class="field">
                                            <label class="label is-small">Idioma da Biblioteca</label>
                                            <div class="control is-expanded">
                                                <div class="select is-fullwidth">
                                                    <select id="selectLanguage"></select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="column is-6">
                                        <div class="field">
                                            <label class="label is-small">Idioma da Aplicação</label>
                                            <div class="control is-expanded">
                                                <div class="select is-fullwidth">
                                                    <select id="languageSelect" onchange="changeLanguage(this.value)">
                                                        <option value="en">English</option>
                                                        <option value="pt_BR">Português (Brasil)</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <hr class="my-6 opacity-10">

                                <div class="block">
                                    <h3 class="title is-6 mb-4"><i class="bi bi-key-fill has-text-primary mr-2"></i>
                                        Chaves do Console</h3>
                                    <div class="notification is-ghost border p-5"
                                        style="border-left: 5px solid var(--color-primary) !important;">
                                        <div class="columns is-vcentered">
                                            <div class="column">
                                                <div class="file has-name is-fullwidth">
                                                    <label class="file-label">
                                                        <input class="file-input" type="file" id="consoleKeysInput"
                                                            name="file" accept=".keys,.txt" required>
                                                        <span class="file-cta">
                                                            <span class="file-icon"><i class="bi bi-upload"></i></span>
                                                            <span class="file-label">Escolher arquivo...</span>
                                                        </span>
                                                        <span class="file-name" id="fileNameDisplay">Nenhum arquivo
                                                            escolhido</span>
                                                    </label>
                                                </div>
                                            </div>
                                            <div class="column is-narrow">
                                                <button class="button is-primary" onclick="submitTitlesSettings()">
                                                    <i class="bi bi-check-lg mr-2"></i> Salvar & Atualizar
                                                </button>
                                            </div>
                                        </div>
                                        <div class="mt-2 is-flex is-align-items-center gap-2">
                                            {% if valid_keys %}
                                            <span class="tag is-success is-light"><i
                                                    class="bi bi-check-circle mr-1"></i> {{ t('Keys are valid')
                                                }}</span>
                                            {% else %}
                                            <span class="tag is-danger is-light"><i class="bi bi-x-circle mr-1"></i> {{
                                                t('Keys missing') }}</span>
                                            {% endif %}
                                            <span class="is-size-7 opacity-50 uppercase tracking-widest">{{ t('Required
                                                for identification') }}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Authentication Section -->
                    <section id="section-Authentication" class="settings-section is-hidden">
                        <div class="card box shadow-sm">
                            <header class="card-header border-none shadow-none">
                                <p class="card-header-title has-text-primary">
                                    <i class="bi bi-people-fill mr-2"></i> {{ t('User Management') }}
                                </p>
                            </header>
                            <div class="card-content pt-0">
                                <div class="table-container">
                                    <table class="table is-fullwidth is-hoverable" id="userTable">
                                        <thead>
                                            <tr>
                                                <th>{{ t('User') }}</th>
                                                <th>{{ t('Permissions') }}</th>
                                                <th class="has-text-right">{{ t('Actions') }}</th>
                                            </tr>
                                        </thead>
                                        <tbody></tbody>
                                    </table>
                                </div>

                                <div class="block mt-6">
                                    <h3 class="title is-6 mb-4"><i
                                            class="bi bi-person-plus-fill has-text-primary mr-2"></i> {{ t('Add New
                                        User') }}</h3>
                                    <div class="notification is-ghost border p-5"
                                        style="border-left: 5px solid var(--color-primary) !important;">
                                        <form onsubmit="event.preventDefault(); submitNewUser();">
                                            <div class="columns">
                                                <div class="column">
                                                    <div class="field">
                                                        <label class="label is-small">{{ t('Username') }}</label>
                                                        <div class="control">
                                                            <input class="input" type="text" id="inputNewUser"
                                                                placeholder="Ex: admin" pattern="^[a-zA-Z0-9_-]{3,20}$"
                                                                title="3-20 caracteres (letras, números, _ ou -)"
                                                                required autocomplete="username">
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="column">
                                                    <div class="field">
                                                        <label class="label is-small">{{ t('Password') }}</label>
                                                        <div class="control">
                                                            <input class="input" type="password"
                                                                id="inputNewUserPassword" minlength="6" required
                                                                autocomplete="new-password">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="field is-grouped is-grouped-multiline mb-5">
                                                <div class="control">
                                                    <label class="checkbox mr-4">
                                                        <input type="checkbox" id="checkboxNewUserShopAccess" checked>
                                                        {{
                                                        t('Shop Access') }}
                                                    </label>
                                                </div>
                                                <div class="control">
                                                    <label class="checkbox mr-4">
                                                        <input type="checkbox" id="checkboxNewUserBackupAccess"> {{
                                                        t('Backup Access') }}
                                                    </label>
                                                </div>
                                                <div class="control">
                                                    <label class="checkbox">
                                                        <input type="checkbox" id="checkboxNewUserAdminAccess"> {{
                                                        t('Admin
                                                        Access') }}
                                                    </label>
                                                </div>
                                            </div>

                                            <button class="button is-primary is-fullwidth-mobile" type="submit">
                                                {{ t('Create Account') }}
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Library Section -->
                    <section id="section-Library" class="settings-section is-hidden">
                        <div class="card box shadow-sm">
                            <header class="card-header border-none shadow-none">
                                <p class="card-header-title has-text-primary">
                                    <i class="bi bi-folder2-open mr-2"></i> {{ t('Library Locations') }}
                                    <span class="ml-2 tag" id="watchdogStatus">
                                        <span class="icon"><i class="bi bi-check-circle text-success"></i></span>
                                        <span>Watchdog: {{ t('Checking...') }}</span>
                                    </span>
                                </p>
                            </header>
                            <div class="card-content pt-0">
                                <!-- Watchdog status indicator -->
                                <div class="notification is-light is-info is-small py-2 px-3 mb-4"
                                    id="watchdogStatusBanner">
                                    <span id="watchdogStatusText">{{ t('Checking watchdog status...') }}</span>
                                </div>

                                <!-- Estatísticas removidas conforme solicitação -->
                                <div class="table-container mb-5">
                                    <table class="table is-fullwidth" id="pathsTable">
                                        <thead>
                                            <tr>
                                                <th>{{ t('Storage Path') }}</th>
                                                <th class="has-text-centered">Jogos</th>
                                                <th class="has-text-centered">Arquivos</th>
                                                <th class="has-text-centered">Tamanho</th>
                                                <th class="has-text-centered">Último Scan</th>
                                                <th class="has-text-right">{{ t('Actions') }}</th>
                                            </tr>
                                        </thead>
                                        <tbody></tbody>
                                    </table>
                                </div>

                                <div class="columns is-vcentered">
                                    <div class="column">
                                        <div class="field has-addons">
                                            <div class="control is-expanded">
                                                <input class="input" type="text" id="libraryPathInput"
                                                    placeholder="/mnt/games">
                                            </div>
                                            <div class="control">
                                                <button class="button is-primary" onclick="submitNewLibraryPath()">
                                                    {{ t('Add Path') }}
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="column is-narrow">
                                        <button class="button is-warning is-outlined scanBtn mr-2"
                                            onclick="scanLibrary()">
                                            <span class="icon"><i class="bi bi-arrow-clockwise"></i></span>
                                            <span>{{ t('Full Scan') }}</span>
                                        </button>
                                        <button class="button is-warning is-outlined" id="btnCleanupOrphaned"
                                            onclick="cleanupOrphaned()">
                                            <span class="icon"><i class="bi bi-trash"></i></span>
                                            <span>Limpar Órfãos</span>
                                        </button>
                                    </div>
                                </div>
                                <div id="cleanupStats" class="is-hidden mt-3">
                                    <div class="notification is-info is-light py-2 is-size-7">
                                        <span id="cleanupMissingFiles">0</span> arquivos deletados do disco |
                                        <span id="cleanupMissingApps">0</span> registros órfãos
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- File Explorer Section -->
                    <section id="section-FileExplorer" class="settings-section is-hidden">
                        <div class="card box shadow-sm">
                            <header class="card-header border-none shadow-none">
                                <p class="card-header-title has-text-info">
                                    <i class="bi bi-files mr-2"></i> Explorador de Arquivos da Biblioteca
                                </p>
                                <div class="card-header-icon pt-4 pr-5">
                                    <button class="button is-small is-dark is-outlined" onclick="fillFilesExplorer()">
                                        <i class="bi bi-arrow-clockwise mr-1"></i> Atualizar
                                    </button>
                                </div>
                            </header>
                            <div class="card-content pt-0">
                                <p class="is-size-7 mb-4 opacity-70">Visualize todos os arquivos físicos indexados na
                                    biblioteca, com
                                    informações detalhadas sobre cada arquivo.</p>

                                <!-- Filters -->
                                <div class="box is-shadowless border p-3 mb-4"
                                    style="border-left: 4px solid var(--color-primary) !important;">
                                    <div class="columns is-mobile">
                                        <div class="column">
                                            <div class="field">
                                                <label class="label is-small">Buscar</label>
                                                <div class="control has-icons-left">
                                                    <input class="input is-small" type="text" id="fileSearchInput"
                                                        placeholder="Buscar em todas as pastas...">
                                                    <span class="icon is-small is-left">
                                                        <i class="bi bi-search"></i>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="column is-narrow">
                                            <div class="field">
                                                <label class="label is-small">Tipo</label>
                                                <div class="control">
                                                    <div class="select is-small is-fullwidth">
                                                        <select id="fileTypeFilter">
                                                            <option value="">Todos</option>
                                                            <option value=".nsp">NSP</option>
                                                            <option value=".nsz">NSZ</option>
                                                            <option value=".xci">XCI</option>
                                                            <option value=".xcz">XCZ</option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="column is-narrow">
                                            <div class="field">
                                                <label class="label is-small">Status</label>
                                                <div class="control">
                                                    <div class="select is-small is-fullwidth">
                                                        <select id="fileStatusFilter">
                                                            <option value="">Todos</option>
                                                            <option value="identified">Identificado</option>
                                                            <option value="error">Erro</option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Files Table -->
                                <!-- Breadcrumb -->
                                <nav class="breadcrumb is-small mb-4 has-bullet-separator" aria-label="breadcrumbs">
                                    <ul id="fileExplorerBreadcrumb">
                                        <li class="is-active"><a href="javascript:void(0)"
                                                onclick="setExplorerPath('')"><i class="bi bi-hdd-fill mr-1"></i>
                                                Root</a></li>
                                    </ul>
                                </nav>

                                <div class="table-container">
                                    <table class="table is-fullwidth is-hoverable is-size-7" id="filesExplorerTable">
                                        <thead>
                                            <tr>
                                                <th>Nome do Arquivo</th>
                                                <th>Caminho</th>
                                                <th width="100">Tamanho</th>
                                                <th width="120">Tipo</th>
                                                <th width="100" class="has-text-centered">Status</th>
                                                <th width="80" class="has-text-right">Ações</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Populated by JS -->
                                        </tbody>
                                    </table>
                                </div>

                                <!-- Pagination Info -->
                                <div class="is-flex is-justify-content-space-between is-align-items-center mt-3">
                                    <span class="is-size-7 opacity-50" id="filesExplorerCount">0 arquivos
                                        encontrados</span>
                                </div>
                            </div>
                        </div>
                    </section>
                    <!-- Renaming Section -->
                    <section id="section-Renaming" class="settings-section is-hidden">
                        <div class="card box shadow-sm">
                            <header class="card-header border-none shadow-none">
                                <p class="card-header-title has-text-primary">
                                    <i class="bi bi-pencil-square mr-2"></i> Renomeação Automática
                                </p>
                            </header>
                            <div class="card-content pt-0">
                                <div class="notification is-ghost border p-4 mb-5"
                                    style="border-left: 5px solid var(--color-info) !important;">
                                    <p class="is-size-7 opacity-70 mb-2">
                                        Use os seguintes placeholders para definir seus padrões:
                                    </p>
                                    <div class="tags">
                                        <span class="tag is-white font-mono pointer"
                                            onclick="insertTag('{Name}')">{Name}</span>
                                        <span class="tag is-white font-mono pointer"
                                            onclick="insertTag('{TitleID}')">{TitleID}</span>
                                        <span class="tag is-white font-mono pointer"
                                            onclick="insertTag('{Version}')">{Version}</span>
                                        <span class="tag is-white font-mono pointer"
                                            onclick="insertTag('{Region}')">{Region}</span>
                                    </div>
                                </div>

                                <div class="field mb-5">
                                    <label class="label is-small">Padrão para Jogo Base (NSP/XCI)</label>
                                    <div class="control">
                                        <input class="input font-mono is-small" type="text" id="patternBase"
                                            placeholder="{Name} [{TitleID}] [v{Version}]">
                                    </div>
                                </div>

                                <div class="field mb-5">
                                    <label class="label is-small">Padrão para Update</label>
                                    <div class="control">
                                        <input class="input font-mono is-small" type="text" id="patternUpd"
                                            placeholder="{Name} [UPD] [{TitleID}] [v{Version}]">
                                    </div>
                                </div>

                                <div class="field mb-6">
                                    <label class="label is-small">Padrão para DLC</label>
                                    <div class="control">
                                        <input class="input font-mono is-small" type="text" id="patternDlc"
                                            placeholder="{Name} [DLC] [{TitleID}] [v{Version}]">
                                    </div>
                                </div>

                                <div class="buttons">
                                    <button class="button is-primary" onclick="saveRenamingSettings()">
                                        <i class="bi bi-save2-fill mr-2"></i> Salvar Padrões
                                    </button>
                                    <button class="button is-ghost" onclick="previewRenaming()">
                                        <i class="bi bi-eye mr-2"></i> Prever
                                    </button>
                                    <button class="button is-danger is-light ml-auto" onclick="runRenamingJob()">
                                        <i class="bi bi-play-circle-fill mr-2"></i> Renomear Tudo Agora
                                    </button>
                                </div>

                                <!-- Preview Result -->
                                <div id="renamingPreview" class="is-hidden mt-5">
                                    <p class="heading has-text-weight-bold mb-3">Pré-visualização</p>
                                    <div class="box is-shadowless border is-size-7 font-mono" id="previewContent"
                                        style="border-left: 4px solid var(--color-primary) !important;">
                                        <!-- content -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- TitleDB Section -->
                    <section id="section-TitleDB" class="settings-section is-hidden">
                        <div class="card box shadow-sm">
                            <header class="card-header border-none shadow-none">
                                <p class="card-header-title has-text-primary">
                                    <i class="bi bi-database-fill mr-2"></i> {{ t('TitleDB Sources') }}
                                </p>
                                <div class="card-header-icon pt-4 pr-5">
                                    <button class="button is-small is-warning is-outlined updateTitleDBBtn mr-2"
                                        onclick="forceTitleDBUpdate()">
                                        <i class="bi bi-cloud-download mr-1"></i> {{ t('Force Update') }}
                                    </button>
                                    <button class="button is-small is-ghost" onclick="refreshTitleDBDates()"
                                        title="{{ t('Refresh remote dates') }}">
                                        <i class="bi bi-calendar-event mr-1"></i>
                                    </button>
                                </div>
                            </header>
                            <div class="card-content pt-0">
                                {% if active_source %}
                                <nav class="level box is-shadowless notification py-3 mb-6"
                                    style="background: rgba(87,13,248,0.05)">
                                    <div class="level-item has-text-centered">
                                        <div>
                                            <p class="heading">{{ t('Active Source') }}</p>
                                            <p class="title is-5 has-text-primary">{{ active_source.name }}</p>
                                        </div>
                                    </div>
                                    <div class="level-item has-text-centered">
                                        <div>
                                            <p class="heading">{{ t('Last Download') }}</p>
                                            <p class="title is-5">{{ active_source.last_download_date }}</p>
                                        </div>
                                    </div>
                                    <div class="level-item has-text-centered">
                                        <div>
                                            <p class="heading">{{ t('Titles Detected') }}</p>
                                            <p class="title is-5">{{ active_source.titles_count }}</p>
                                        </div>
                                    </div>
                                    <div class="level-item has-text-centered">
                                        <div>
                                            <p class="heading">{{ t('Status') }}</p>
                                            <span
                                                class="tag {{ 'is-success' if active_source.is_updated else 'is-warning' }} is-light">
                                                {{ t('Up to date') if active_source.is_updated else t('Outdated') }}
                                            </span>
                                        </div>
                                    </div>
                                </nav>
                                {% endif %}

                                <div class="table-container">
                                    <table class="table is-fullwidth" id="titledbSourcesTable">
                                        <thead>
                                            <tr>
                                                <th>{{ t('Source') }}</th>
                                                <th>{{ t('Last Modified (Remote)') }}</th>
                                                <th>{{ t('Last Download (Local)') }}</th>
                                                <th>{{ t('Priority') }}</th>
                                                <th>{{ t('Status') }}</th>
                                                <th class="has-text-right">{{ t('Actions') }}</th>
                                            </tr>
                                        </thead>
                                        <tbody></tbody>
                                    </table>
                                </div>

                                <div class="block mt-6">
                                    <button class="button is-small is-primary is-outlined" id="toggleAddSource">
                                        <i class="bi bi-plus-lg mr-2"></i> {{ t('Add Custom Source') }}
                                    </button>

                                    <div id="addSourceForm" class="is-hidden mt-4 notification is-ghost border p-5"
                                        style="border-left: 5px solid var(--color-success) !important;">
                                        <div class="columns is-multiline">
                                            <div class="column is-6">
                                                <div class="field">
                                                    <label class="label is-small">{{ t('Name') }}</label>
                                                    <input class="input is-small" type="text" id="inputSourceName"
                                                        maxlength="50" required placeholder="Ex: My Custom Source">
                                                </div>
                                            </div>
                                            <div class="column is-6">
                                                <div class="field">
                                                    <label class="label is-small">{{ t('URL') }}</label>
                                                    <input class="input is-small" type="url" id="inputSourceUrl"
                                                        pattern="https?://.+"
                                                        title="Deve começar com http:// ou https://" required
                                                        placeholder="https://example.com/titledb.json">
                                                </div>
                                            </div>
                                            <div class="column is-6">
                                                <div class="field">
                                                    <label class="label is-small">{{ t('Type') }}</label>
                                                    <div class="select is-small is-fullwidth">
                                                        <select id="inputSourceType">
                                                            <option value="json" selected>JSON</option>
                                                            <option value="zip_legacy">Legacy ZIP</option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="column is-6">
                                                <div class="field">
                                                    <label class="label is-small">{{ t('Priority') }}</label>
                                                    <input class="input is-small" type="number" id="inputSourcePriority"
                                                        value="50">
                                                </div>
                                            </div>
                                        </div>
                                        <button class="button is-primary is-small" onclick="submitNewSource()">{{
                                            t('Save Source') }}</button>
                                    </div>
                                </div>

                                <div class="box is-shadowless mt-4" style="background: rgba(87,13,248,0.03);">
                                    <label class="checkbox is-flex is-align-items-center">
                                        <input type="checkbox" id="autoUseLatest" class="mr-2">
                                        {{ t('Auto-use latest') }} - <span class="is-size-7 ml-2 opacity-75">{{
                                            t('Automatically use the source with the most recent data') }}</span>
                                    </label>
                                </div>

                                <div class="buttons mt-4">
                                    <button class="button is-primary" onclick="saveTitleDBSettings()">
                                        <i class="bi bi-check-lg mr-1"></i> {{ t('Save') }}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Shop Section -->
                    <section id="section-Shop" class="settings-section is-hidden">
                        <div class="card box shadow-sm">
                            <header class="card-header border-none shadow-none">
                                <p class="card-header-title has-text-primary">
                                    <i class="bi bi-cart-fill mr-2"></i> {{ t('Shop Configuration') }}
                                </p>
                            </header>
                            <div class="card-content pt-0">
                                <div class="field mb-6">
                                    <label class="label">{{ t('Public Access URL') }}</label>
                                    <div class="field has-addons">
                                        <p class="control"><a class="button is-static">https://</a></p>
                                        <div class="control is-expanded">
                                            <input class="input" id="shopHostInput" type="text"
                                                placeholder="tinfoil.domain.com">
                                        </div>
                                    </div>
                                    <p class="help opacity-50">{{ t('Used for host verification and remote access') }}
                                    </p>
                                </div>

                                <div class="field is-grouped mb-6">
                                    <div class="control">
                                        <label class="checkbox has-text-weight-bold mr-6">
                                            <input type="checkbox" id="publicShopCheck"> {{ t('Public Index') }}
                                        </label>
                                    </div>
                                    <div class="control">
                                        <label class="checkbox has-text-weight-bold">
                                            <input type="checkbox" id="encryptShopCheck" checked> {{ t('Encrypted Shop')
                                            }}
                                        </label>
                                    </div>
                                    <div class="control">
                                        <label class="checkbox has-text-weight-bold">
                                            <input type="checkbox" id="publicProfileCheck"> Perfil Público (Web)
                                        </label>
                                    </div>
                                </div>

                                <div class="field mb-6">
                                    <label class="label">{{ t('Message of the Day') }}</label>
                                    <div class="control">
                                        <textarea class="textarea font-mono is-small" id="motdTextArea" rows="4"
                                            placeholder="Welcome to MyFoil..."></textarea>
                                    </div>
                                </div>

                                <button class="button is-primary px-6" onclick="submitShopSettings()">
                                    {{ t('Save Shop Changes') }}
                                </button>
                            </div>
                        </div>
                    </section>

                    <!-- Errors Section -->
                    <section id="section-Errors" class="settings-section is-hidden">
                        <div class="card box shadow-sm">
                            <header class="card-header border-none shadow-none">
                                <p class="card-header-title has-text-danger">
                                    <i class="bi bi-exclamation-octagon-fill mr-2"></i> Arquivos não Identificados
                                </p>
                                <div class="card-header-icon pt-4 pr-5">
                                    <button class="button is-small is-dark is-outlined" onclick="fillErrorsTable()">
                                        <i class="bi bi-arrow-clockwise mr-1"></i> Atualizar
                                    </button>
                                </div>
                            </header>
                            <div class="card-content pt-0">
                                <p class="is-size-7 mb-4 opacity-70">Abaixo estão listados os arquivos que o MyFoil não
                                    conseguiu identificar automaticamente. Você pode verificar o motivo do erro ou
                                    excluir o arquivo se for lixo.</p>
                                <div class="table-container">
                                    <div id="bulkActionsBar"
                                        class="notification is-ghost border py-2 px-3 mb-3 is-hidden"
                                        style="border-left: 5px solid var(--color-primary) !important;">
                                        <div class="is-flex is-justify-content-between is-align-items-center">
                                            <span class="is-size-7 has-text-weight-bold" id="selectedCountText">0 itens
                                                selecionados</span>
                                            <div class="buttons">
                                                <button class="button is-small is-danger is-light"
                                                    onclick="bulkDeleteFiles()">
                                                    <i class="bi bi-trash3 mr-1"></i> Excluir Selecionados
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <table class="table is-fullwidth is-hoverable" id="errorsTable">
                                        <thead>
                                            <tr>
                                                <th width="40"><input type="checkbox" id="selectAllErrors"
                                                        onclick="toggleAllErrors(this)">
                                                </th>
                                                <th>Arquivo</th>
                                                <th>Erro</th>
                                                <th class="has-text-right">Ações</th>
                                            </tr>
                                        </thead>
                                        <tbody></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Tags Section -->
                    <section id="section-Tags" class="settings-section is-hidden">
                        <div class="card box shadow-sm">
                            <header class="card-header border-none shadow-none">
                                <p class="card-header-title has-text-primary">
                                    <i class="bi bi-tags-fill mr-2"></i> Gerenciar Tags
                                </p>
                            </header>
                            <div class="card-content pt-0">
                                <div class="notification is-ghost border p-5 mb-5"
                                    style="border-left: 5px solid var(--color-primary) !important;">
                                    <div class="columns is-vcentered">
                                        <div class="column is-4">
                                            <input class="input" type="text" id="tagNameInput"
                                                placeholder="Nome da Tag">
                                        </div>
                                        <div class="column is-3">
                                            <input class="input" type="color" id="tagColorInput" value="#3273dc"
                                                style="height: 40px; padding: 2px;">
                                        </div>
                                        <div class="column is-3">
                                            <div class="select is-fullwidth">
                                                <select id="tagIconInput">
                                                    <option value="bi-tag">Etiqueta</option>
                                                    <option value="bi-star">Estrela</option>
                                                    <option value="bi-heart">Coração</option>
                                                    <option value="bi-fire">Fogo</option>
                                                    <option value="bi-controller">Controle</option>
                                                    <option value="bi-trophy">Troféu</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="column is-2">
                                            <button class="button is-primary is-fullwidth"
                                                onclick="createTag()">Criar</button>
                                        </div>
                                    </div>
                                </div>

                                <div class="table-container">
                                    <table class="table is-fullwidth" id="tagsTable">
                                        <thead>
                                            <tr>
                                                <th>Tag</th>
                                                <th>Visualização</th>
                                                <th class="has-text-right">Ações</th>
                                            </tr>
                                        </thead>
                                        <tbody></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Activity Section -->
                    <section id="section-Activity" class="settings-section is-hidden">
                        <div class="card box shadow-sm">
                            <header class="card-header border-none shadow-none">
                                <p class="card-header-title has-text-primary">
                                    <i class="bi bi-clock-history mr-2"></i> Histórico de Atividade
                                </p>
                                <div class="card-header-icon pt-4 pr-5">
                                    <button class="button is-small is-ghost" onclick="fillActivityLogs()">
                                        <i class="bi bi-arrow-clockwise mr-1"></i> Atualizar
                                    </button>
                                </div>
                            </header>
                            <div class="card-content pt-0">
                                <div id="activityLogsList" class="activity-timeline">
                                    <!-- Log items injected via JS -->
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Webhooks Section -->
                    <section id="section-Webhooks" class="settings-section is-hidden">
                        <div class="card box shadow-sm">
                            <header class="card-header border-none shadow-none">
                                <p class="card-header-title has-text-primary">
                                    <i class="bi bi-hdd-network mr-2"></i> Webhooks de Integração
                                </p>
                            </header>
                            <div class="card-content pt-0">
                                <p class="is-size-7 opacity-60 mb-5">
                                    Notifique serviços externos (Discord, Slack, Home Assistant) sobre eventos na sua
                                    biblioteca.
                                </p>

                                <div id="webhooksList" class="mb-5">
                                    <!-- Webhooks will be listed here -->
                                </div>

                                <div class="notification is-ghost border p-5 border"
                                    style="border-left: 5px solid var(--color-primary) !important;">
                                    <p class="heading has-text-weight-bold mb-4">Adicionar Novo Webhook</p>
                                    <div class="columns is-multiline">
                                        <div class="column is-12">
                                            <div class="field">
                                                <label class="label is-size-7">URL do Endpoint</label>
                                                <input class="input is-small" type="url" id="webhookUrl"
                                                    placeholder="https://discord.com/api/webhooks/...">
                                            </div>
                                        </div>
                                        <div class="column is-6">
                                            <div class="field">
                                                <label class="label is-size-7">Segredo (Opcional)</label>
                                                <input class="input is-small" type="text" id="webhookSecret"
                                                    placeholder="Para assinatura HMAC-SHA256">
                                            </div>
                                        </div>
                                        <div class="column is-6">
                                            <div class="field">
                                                <label class="label is-size-7">Eventos</label>
                                                <div class="control">
                                                    <label class="checkbox is-size-7">
                                                        <input type="checkbox" id="eventLibraryUpdated" checked>
                                                        Alteração na Biblioteca
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <button class="button is-primary is-small" onclick="addWebhook()">Adicionar
                                        Webhook</button>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Plugins Section -->

                    <!-- APIs Section -->
                    <section id="section-APIs" class="settings-section is-hidden">
                        <div class="card box shadow-sm">
                            <header class="card-header border-none shadow-none">
                                <p class="card-header-title has-text-primary">
                                    <i class="bi bi-cloud-arrow-down mr-2"></i> APIs Externas
                                </p>
                            </header>
                            <div class="card-content pt-0">
                                <p class="is-size-7 mb-4 opacity-70">
                                    Configure chaves de API para buscar avaliações, ratings e metadados
                                    adicionais de serviços externos.
                                </p>

                                <!-- RAWG API -->
                                <div class="box is-shadowless border p-4 mb-4"
                                    style="border-left: 5px solid var(--color-primary) !important;">
                                    <div class="columns is-vcentered">
                                        <div class="column">
                                            <h4 class="title is-6 mb-2">
                                                <i class="bi bi-star-fill has-text-warning mr-2"></i>
                                                RAWG API
                                            </h4>
                                            <p class="is-size-7 opacity-70 mb-3">
                                                Fornece ratings (Metacritic, usuários), screenshots,
                                                gêneros e tempo de jogo estimado.
                                            </p>
                                            <form onsubmit="return false;">
                                                <div class="field">
                                                    <label class="label is-small">API Key</label>
                                                    <div class="control">
                                                        <input class="input is-small" type="password" id="rawgApiKey"
                                                            placeholder="Obtenha em: https://rawg.io/apidocs"
                                                            autocomplete="new-password">
                                                    </div>
                                                    <p class="help is-size-7">
                                                        Limite: 20,000 requests/mês (gratuito)
                                                        <a href="https://rawg.io/apidocs" target="_blank"
                                                            class="has-text-link">Criar conta</a>
                                                    </p>
                                                </div>
                                            </form>
                                        </div>
                                        <div class="column is-narrow">
                                            <button class="button is-small is-primary is-light"
                                                onclick="testRAWGConnection()">
                                                <i class="bi bi-check-circle mr-1"></i> Testar
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <!-- IGDB API -->
                                <div class="box is-shadowless border p-4 mb-4"
                                    style="border-left: 5px solid #6441a5 !important;">
                                    <div class="columns is-vcentered">
                                        <div class="column">
                                            <h4 class="title is-6 mb-2">
                                                <i class="bi bi-twitch mr-2" style="color: #6441a5;"></i>
                                                IGDB API (Twitch)
                                            </h4>
                                            <p class="is-size-7 opacity-70 mb-3">
                                                Uma das bases de dados mais completas. Requer Client ID e Secret.
                                            </p>
                                            <form onsubmit="return false;">
                                                <div class="columns">
                                                    <div class="column">
                                                        <div class="field">
                                                            <label class="label is-small">Client ID</label>
                                                            <div class="control">
                                                                <input class="input is-small" type="text"
                                                                    id="igdbClientId"
                                                                    placeholder="Client ID do Twitch Dev Portal">
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="column">
                                                        <div class="field">
                                                            <label class="label is-small">Client Secret</label>
                                                            <div class="control">
                                                                <input class="input is-small" type="password"
                                                                    id="igdbClientSecret" placeholder="Client Secret"
                                                                    autocomplete="new-password">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </form>
                                            <p class="help is-size-7">
                                                Obtenha em: <a href="https://dev.twitch.tv/console" target="_blank"
                                                    class="has-text-link">Twitch Developer Portal</a>
                                            </p>
                                        </div>
                                        <div class="column is-narrow">
                                            <button class="button is-small is-primary is-light"
                                                onclick="testIGDBConnection()">
                                                <i class="bi bi-check-circle mr-1"></i> Testar
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <!-- Global API Settings -->
                                <div class="box is-shadowless border p-4 mb-4"
                                    style="border-left: 4px solid var(--color-primary) !important;">
                                    <h4 class="title is-6 mb-3">Configurações Globais de Metadados</h4>
                                    <div class="field">
                                        <label class="label is-small">Próximos Lançamentos (Dias à frente)</label>
                                        <div class="control" style="max-width: 200px;">
                                            <input class="input is-small" type="number" id="upcomingDaysAhead" min="1"
                                                max="365" placeholder="30">
                                        </div>
                                        <p class="help">Define quantos dias à frente buscar na página de "Próximos".</p>
                                    </div>
                                </div>

                                <!-- Metadata Stats -->
                                <div class="box is-shadowless border p-4 mb-4 bg-light-soft">
                                    <h4 class="title is-6 mb-3">Estatísticas de Metadados</h4>
                                    <div class="columns is-mobile has-text-centered">
                                        <div class="column">
                                            <p class="heading is-size-7 opacity-50">Jogos com Dados</p>
                                            <p class="title is-4 has-text-primary" id="statMetadataGames">--</p>
                                        </div>
                                        <div class="column">
                                            <p class="heading is-size-7 opacity-50">API RAWG</p>
                                            <span class="tag is-success is-light" id="statusRAWG">Ativa</span>
                                        </div>
                                        <div class="column">
                                            <p class="heading is-size-7 opacity-50">API IGDB</p>
                                            <span class="tag is-success is-light" id="statusIGDB">Ativa</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Automated Metadata Fetch -->
                                <div class="box is-shadowless border p-4 mb-4 bg-light-soft" id="metadata-fetch-status-container">
                                    <h4 class="title is-6 mb-3">Busca Automática de Metadados</h4>
                                    <div id="metadata-fetch-status-content">
                                        <div class="is-flex is-align-items-center mb-3">
                                            <div class="mr-4">
                                                <p class="heading is-size-7 opacity-50">Status de Agendamento</p>
                                                <span class="tag is-info is-light">2x por dia (12h)</span>
                                            </div>
                                            <div id="last-metadata-fetch-info">
                                                <p class="heading is-size-7 opacity-50">Última Execução</p>
                                                <span class="is-size-7" id="last-metadata-fetch-time">Nunca executado</span>
                                            </div>
                                        </div>
                                        
                                        <div class="buttons">
                                            <button class="button is-small is-primary is-outlined" onclick="triggerMetadataFetch()">
                                                <i class="bi bi-stars mr-1"></i> Buscar Agora
                                            </button>
                                            <button class="button is-small is-warning is-outlined" onclick="triggerMetadataFetch(true)">
                                                <i class="bi bi-lightning-fill mr-1"></i> Forçar (Ignorar Agendamento)
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <!-- Bulk Actions -->
                                <div class="notification is-ghost border p-4"
                                    style="border-left: 5px solid var(--color-info) !important;">
                                    <h4 class="title is-6 mb-3">Ações em Massa</h4>
                                    <div class="buttons">
                                        <button class="button is-info is-light" id="btnRefreshAllMetadata"
                                            onclick="refreshAllMetadata()">
                                            <i class="bi bi-arrow-repeat mr-2"></i>
                                            Atualizar Metadados de Todos os Jogos
                                        </button>
                                    </div>
                                    <p class="help is-size-7 opacity-70">
                                        ⚠️ Isso buscará notas e tempo de jogo para todos os itens identificados. Pode
                                        levar tempo.
                                    </p>
                                </div>

                                <button class="button is-primary mt-4" onclick="saveAPISettings()">
                                    <i class="bi bi-check-lg mr-1"></i> Salvar Configurações
                                </button>
                            </div>
                        </div>
                    </section>

                    <!-- Help Section -->
                    <section id="section-Help" class="settings-section is-hidden">
                        <div class="card box shadow-sm">
                            <header class="card-header border-none shadow-none">
                                <p class="card-header-title has-text-info">
                                    <i class="bi bi-question-circle mr-2"></i> Ajuda e Documentação
                                </p>
                            </header>
                            <div class="card-content pt-0">

                                <!-- Keyboard Shortcuts -->
                                <div class="box is-shadowless border p-4 mb-4"
                                    style="border-left: 4px solid var(--color-info) !important;">
                                    <p class="heading has-text-weight-bold mb-3"><i class="bi bi-keyboard mr-2"></i>
                                        Atalhos de Teclado</p>
                                    <div class="columns is-multiline">
                                        <div class="column is-6">
                                            <table class="table is-fullwidth is-size-7">
                                                <thead>
                                                    <tr>
                                                        <th>Atalho</th>
                                                        <th>Ação</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td><kbd>Ctrl/Cmd + K</kbd></td>
                                                        <td>Focar na busca</td>
                                                    </tr>
                                                    <tr>
                                                        <td><kbd>ESC</kbd></td>
                                                        <td>Fechar modais</td>
                                                    </tr>
                                                    <tr>
                                                        <td><kbd>← / →</kbd></td>
                                                        <td>Navegar paginação</td>
                                                    </tr>
                                                    <tr>
                                                        <td><kbd>E</kbd> (no modal)</td>
                                                        <td>Editar metadados</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                        <div class="column is-6">
                                            <table class="table is-fullwidth is-size-7">
                                                <thead>
                                                    <tr>
                                                        <th>Atalho</th>
                                                        <th>Ação</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td><kbd>F</kbd> (no modal)</td>
                                                        <td>Toggle Wishlist</td>
                                                    </tr>
                                                    <tr>
                                                        <td><kbd>D</kbd> (no modal)</td>
                                                        <td>Baixar arquivo</td>
                                                    </tr>
                                                    <tr>
                                                        <td><kbd>Enter</kbd></td>
                                                        <td>Abrir jogo selecionado</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>

                                <!-- Quick Start Guide -->
                                <div class="box is-shadowless border p-4 mb-4"
                                    style="border-left: 4px solid var(--color-success) !important;">
                                    <p class="heading has-text-weight-bold mb-3"><i class="bi bi-book mr-2"></i> Guia
                                        Rápido</p>
                                    <div class="content is-size-7">
                                        <ol>
                                            <li><strong>Configurar Biblioteca:</strong> Vá em "Biblioteca" e adicione o
                                                caminho da pasta com
                                                seus jogos NSP/NSZ/XCI.</li>
                                            <li><strong>Atualizar TitleDB:</strong> Clique em "Atualizar Agora" na aba
                                                TitleDB para baixar
                                                informações dos jogos.</li>
                                            <li><strong>Escanear:</strong> Após adicionar a pasta, clique em "Escanear
                                                Biblioteca" para
                                                identificar seus jogos.</li>
                                            <li><strong>Configurar Loja:</strong> Na aba "Loja", defina o hostname e
                                                ative a shop para o
                                                Tinfoil.</li>
                                            <li><strong>Conectar Tinfoil:</strong> No Switch, adicione
                                                <code>protocol://HOST:5000</code> nas
                                                File Browsers.
                                            </li>
                                        </ol>
                                    </div>
                                </div>

                                <!-- FAQ -->
                                <div class="box is-shadowless border p-4 mb-4"
                                    style="border-left: 4px solid var(--color-warning) !important;">
                                    <p class="heading has-text-weight-bold mb-3"><i
                                            class="bi bi-patch-question mr-2"></i> Perguntas
                                        Frequentes</p>
                                    <div class="content is-size-7">
                                        <details class="mb-3">
                                            <summary class="has-text-weight-bold mb-2" style="cursor: pointer;">Como
                                                identificar jogos que
                                                aparecem como "Unknown"?</summary>
                                            <p>Vá em "Erros/Identificação", encontre o jogo e clique em "Reconhecer".
                                                Busque o jogo correto
                                                no TitleDB e clique em "Usar Metadados".</p>
                                        </details>
                                        <details class="mb-3">
                                            <summary class="has-text-weight-bold mb-2" style="cursor: pointer;">Por que
                                                alguns jogos não
                                                aparecem na loja do Tinfoil?</summary>
                                            <p>Verifique se: (1) O arquivo foi identificado corretamente, (2) Você tem
                                                permissão
                                                "shop_access" no seu usuário, (3) A loja está configurada como pública
                                                ou você tem login
                                                correto.</p>
                                        </details>
                                        <details class="mb-3">
                                            <summary class="has-text-weight-bold mb-2" style="cursor: pointer;">Como
                                                adicionar metadados
                                                customizados?</summary>
                                            <p>Clique no jogo, depois em "Editar Dados". Você pode buscar informações no
                                                TitleDB ou
                                                preencher manualmente.</p>
                                        </details>
                                        <details class="mb-3">
                                            <summary class="has-text-weight-bold mb-2" style="cursor: pointer;">Qual a
                                                diferença entre as
                                                fontes do TitleDB?</summary>
                                            <p>MyFoil suporta múltiplas fontes com fallback automático. Fontes com maior
                                                prioridade são
                                                tentadas primeiro. Recomendamos manter ao menos 2 fontes ativas.</p>
                                        </details>
                                    </div>
                                </div>

                                <!-- Links -->
                                <div class="box is-shadowless border p-4"
                                    style="border-left: 4px solid var(--color-primary) !important;">
                                    <p class="heading has-text-weight-bold mb-3"><i class="bi bi-link-45deg mr-2"></i>
                                        Links Úteis</p>
                                    <div class="buttons">
                                        <a href="https://github.com/fernandodimas/MyFoil" target="_blank"
                                            class="button is-small is-dark">
                                            <i class="bi bi-github mr-2"></i> GitHub
                                        </a>
                                        <a href="https://github.com/fernandodimas/MyFoil/issues" target="_blank"
                                            class="button is-small is-info">
                                            <i class="bi bi-bug mr-2"></i> Reportar Bug
                                        </a>
                                        <a href="https://github.com/fernandodimas/MyFoil/wiki" target="_blank"
                                            class="button is-small is-link">
                                            <i class="bi bi-book mr-2"></i> Wiki Completa
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <section id="section-Plugins" class="settings-section is-hidden">
                        <div class="card box shadow-sm">
                            <header class="card-header border-none shadow-none">
                                <p class="card-header-title has-text-primary">
                                    <i class="bi bi-patch-check mr-2"></i> Plugins Instalados
                                </p>
                            </header>
                            <div class="card-content pt-0">
                                <p class="is-size-7 opacity-60 mb-5">
                                    Plugins permitem estender a funcionalidade do MyFoil com recursos personalizados.
                                </p>
                                <div id="pluginsList">
                                    <!-- Plugins injected by JS -->
                                </div>
                                <div class="notification is-ghost border is-size-7 mt-5"
                                    style="border-left: 5px solid var(--color-info) !important;">
                                    <i class="bi bi-info-circle mr-2"></i> Para instalar novos plugins, adicione-os na
                                    pasta <code>app/plugins/</code>.
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Backups Section -->
                    <section id="section-Backups" class="settings-section is-hidden">
                        <div class="card box shadow-sm">
                            <header class="card-header border-none shadow-none">
                                <p class="card-header-title has-text-primary">
                                    <i class="bi bi-shield-check mr-2"></i> Gerenciamento de Backups
                                </p>
                                <div class="card-header-icon pt-4 pr-5">
                                    <button class="button is-small is-primary" onclick="createManualBackup()"
                                        id="btnCreateBackup">
                                        <i class="bi bi-plus-lg mr-1"></i> Criar Backup
                                    </button>
                                </div>
                            </header>
                            <div class="card-content pt-0">
                                <p class="is-size-7 mb-4 opacity-70">Gerencie os backups do banco de dados e
                                    configurações. Os backups são armazenados localmente na pasta de configuração.</p>

                                <div class="table-container">
                                    <table class="table is-fullwidth is-hoverable" id="backupsTable">
                                        <thead>
                                            <tr>
                                                <th>Arquivo</th>
                                                <th>Tipo</th>
                                                <th>Tamanho</th>
                                                <th>Data de Criação</th>
                                                <th class="has-text-right">Ações</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Preenchido via JS -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Cloud Section -->
                    <section id="section-Cloud" class="settings-section is-hidden">
                        <div class="card box shadow-sm">
                            <header class="card-header border-none shadow-none">
                                <p class="card-header-title has-text-primary">
                                    <i class="bi bi-cloud-fill mr-2"></i> Integração Cloud
                                </p>
                            </header>
                            <div class="card-content pt-0">
                                <div class="columns">
                                    <div class="column is-6">
                                        <div class="box border is-shadowless" id="cloud-gdrive"
                                            style="border-left: 4px solid var(--color-primary) !important;">
                                            <p class="has-text-weight-bold mb-3"><i class="bi bi-google mr-2"></i>
                                                Google Drive</p>
                                            <p class="is-size-7 opacity-60 mb-4">Sincronize sua biblioteca diretamente
                                                com uma pasta do Google Drive.</p>
                                            <div class="cloud-status mb-3 is-hidden">
                                                <span class="tag is-success is-light"><i
                                                        class="bi bi-check-circle mr-1"></i>
                                                    Conectado</span>
                                            </div>
                                            <button class="button is-small is-primary is-fullwidth btn-connect"
                                                onclick="connectCloud('gdrive')">Conectar</button>
                                            <p class="is-size-7 has-text-danger mt-2 is-hidden btn-config-needed">
                                                Configuração necessária (secret.json não encontrado)</p>
                                        </div>
                                    </div>
                                    <div class="column is-6">
                                        <div class="box border is-shadowless" id="cloud-dropbox"
                                            style="border-left: 4px solid var(--color-info) !important;">
                                            <p class="has-text-weight-bold mb-3"><i class="bi bi-dropbox mr-2"></i>
                                                Dropbox</p>
                                            <p class="is-size-7 opacity-60 mb-4">Mantenha seu acervo seguro e acessível
                                                via Dropbox.</p>
                                            <div class="cloud-status mb-3 is-hidden">
                                                <span class="tag is-success is-light"><i
                                                        class="bi bi-check-circle mr-1"></i>
                                                    Conectado</span>
                                            </div>
                                            <button class="button is-small is-primary is-fullwidth btn-connect"
                                                onclick="connectCloud('dropbox')">Conectar</button>
                                            <p class="is-size-7 has-text-danger mt-2 is-hidden btn-config-needed">
                                                Configuração necessária (app_key.txt não encontrado)</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Modals -->
                    <div class="modal" id="deleteUserModal">
                        <div class="modal-background"></div>
                        <div class="modal-card shadow-2xl">
                            <header class="modal-card-head border-none">
                                <p class="modal-card-title has-text-danger has-text-weight-black"><i
                                        class="bi bi-trash3-fill mr-2"></i> {{
                                    t('Delete User') }}</p>
                                <button class="delete" aria-label="close"
                                    onclick="closeModal('deleteUserModal')"></button>
                            </header>
                            <section class="modal-card-body py-6 modal-text opacity-70">
                                <!-- Text injected via JS -->
                            </section>
                            <footer class="modal-card-foot border-none is-justify-content-flex-end">
                                <button class="button" onclick="closeModal('deleteUserModal')">{{ t('Keep User')
                                    }}</button>
                                <button class="button is-danger btn-confirm">{{ t('Permanently Delete') }}</button>
                            </footer>
                        </div>
                    </div>

                    <div class="modal" id="deletePathModal">
                        <div class="modal-background"></div>
                        <div class="modal-card shadow-2xl">
                            <header class="modal-card-head border-none">
                                <p class="modal-card-title has-text-danger has-text-weight-black"><i
                                        class="bi bi-folder-x mr-2"></i> {{
                                    t('Remove Path') }}</p>
                                <button class="delete" aria-label="close"
                                    onclick="closeModal('deletePathModal')"></button>
                            </header>
                            <section class="modal-card-body py-6 modal-text opacity-70">
                                <!-- Text injected via JS -->
                            </section>
                            <footer class="modal-card-foot border-none is-justify-content-flex-end">
                                <button class="button" onclick="closeModal('deletePathModal')">{{ t('Cancel')
                                    }}</button>
                                <button class="button is-danger btn-confirm">{{ t('Remove Path') }}</button>
                            </footer>
                        </div>
                    </div>



                    <script src="/static/js/settings_bundled.js?v={{ build_version }}"></script>
                    {% endblock %}